name: Time Trigger Task
on:
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘ï¼Œæ–¹ä¾¿æµ‹è¯•
jobs:
  run_tasks:
    runs-on: ubuntu-latest
    permissions:
      contents: write
    env:
      # é…ç½® uv ç¼“å­˜ç›®å½•ï¼Œæ–¹ä¾¿ cache action æ•è·
      UV_CACHE_DIR: /tmp/.uv-cache
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: Set up Rust
        uses: dtolnay/rust-toolchain@stable
      - name: Cache Rust dependencies
        uses: Swatinem/rust-cache@v2
      - name: Install uv
        uses: astral-sh/setup-uv@v5
        with:
          enable-cache: true
          cache-dependency-glob: "pyproject.toml"
      - name: Set up Python
        run: uv python install
      - name: Build and Run
        env:
          DEVICE_KEYS: ${{ secrets.DEVICE_KEYS }}
        run: |
          uv sync
          uv tool install maturin
          uv run maturin develop --release
          uv run python/time_trigger_task/__init__.py
      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– Auto: Update task status [skip ci]"
          file_pattern: "configs/*.json"
