name: Time Trigger Task
on:
  schedule:
    # æ¯ 15 åˆ†é’Ÿè¿è¡Œä¸€æ¬¡ (GitHub Action æœ€å°é—´éš”æ˜¯ 5 åˆ†é’Ÿï¼Œå»ºè®® 10-30 åˆ†é’Ÿ)
    # åˆ†é’Ÿ 0, 15, 30, 45 æ‰§è¡Œ
    - cron: '*/15 * * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨ç‚¹å‡»æŒ‰é’®è§¦å‘ï¼Œæ–¹ä¾¿æµ‹è¯•
jobs:
  run_tasks:
    runs-on: ubuntu-latest
    permissions:
      contents: write  # éœ€è¦å†™æƒé™æ¥æäº¤ executed çŠ¶æ€çš„æ›´æ”¹
    steps:
      # 1. æ£€å‡ºä»£ç 
      - name: Checkout code
        uses: actions/checkout@v4
      # 2. å®‰è£… uv (æé€Ÿ Python åŒ…ç®¡ç†å™¨)
      - name: Install uv
        uses: astral-sh/setup-uv@v4
        with:
          version: "latest"
      # 3. è®¾ç½® Python ç¯å¢ƒ (uv ä¼šè‡ªåŠ¨ç®¡ç†ï¼Œè¿™é‡Œæ˜¾å¼å£°æ˜ç‰ˆæœ¬)
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12" # å»ºè®®ç”¨ç¨³å®šç‰ˆï¼Œ3.14 è¿˜æ²¡æ­£å¼å‘å¸ƒï¼Œ3.12/3.11 å…¼å®¹æ€§æœ€å¥½
      # 4. å®‰è£…ä¾èµ–
      # å¦‚æœä½ æ²¡æœ‰ requirements.txtï¼Œå¯ä»¥ç›´æ¥ç”¨ uv run è‡ªåŠ¨å®‰è£…ä¸´æ—¶ä¾èµ–
      # ä¸‹é¢çš„ run æ­¥éª¤ä¼šè‡ªåŠ¨å¤„ç† "import requests"
      - name: Install dependencies
        run: uv pip install requests
      # 5. è¿è¡Œè„šæœ¬
      - name: Run Task Script
        env:
          # å…³é”®ï¼šå°† GitHub Secret æ³¨å…¥ä¸ºç¯å¢ƒå˜é‡
          DEVICE_KEYS: ${{ secrets.DEVICE_KEYS }}
        # ä½¿ç”¨ uv run ç›´æ¥è¿è¡Œï¼Œç¡®ä¿ä¾èµ–éš”ç¦»
        run: uv run main.py
      # 6. æäº¤æ›´æ”¹ (å¦‚æœ main.py ä¿®æ”¹äº† json æ–‡ä»¶çš„ executed çŠ¶æ€)
      - name: Commit and Push changes
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          commit_message: "ğŸ¤– Auto: Update task status [skip ci]"
          file_pattern: "configs/*.json" # åªæäº¤ configs ç›®å½•ä¸‹çš„ json å˜åŒ–